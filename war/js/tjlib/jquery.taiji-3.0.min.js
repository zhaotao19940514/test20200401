(function($,window,document){var version="3.7.1";$.extend($.fn,{taiji:function(){if(!this.length){if(window.console&&window.console.warn){window.console.warn("没有选择任何节点，直接返回");}return;}var arg1=arguments[0]||{};var aTaiji=$(this).data("aTaiji");if(!aTaiji){aTaiji=new $.Taiji(arg1||{},this);$(this).data("aTaiji",aTaiji);$(window).resize(function(){aTaiji.repostion();});$(document).scroll(function(){aTaiji.repostion();});}if(typeof arg1=="string"){aTaiji[arg1](arguments[1],arguments[2]||{});}return this;}});$.Taiji=function(opts,targetDiv){this.settings=$.extend(true,{},$.Taiji.defaults,opts);this.currentTarget=$(targetDiv);this.base64=new Base64();this.isRunning=false;this.decode=this.base64.decode;this.aclCheck($(this.settings.aclClassName,this.currentTarget));this.repostion();this._init();};$.extend($.Taiji,{prototype:{_init:function(){$(this.currentTarget).addClass("_taiji_");this._initAll();this._bindAll();},_initAll:function(){var $this=this;$.each($.Taiji.inits,function(i,f){f.call($this);
});},_bindAll:function(){var $self=(this),events={},classNames={},$target=$(this.currentTarget);$.each($.Taiji.events,function(event,coll){if(!events[event]){events[event]={};}$.each(coll,function(name,other){$.each(other,function(cn,handler){var className=$self.settings[name][cn];events[event][className]=handler;});});});$.each(events,function(aEvent,cllol){$target.off(aEvent+".taiji").on(aEvent+".taiji",function(event){var $target=($(event.target).is("a")||$(event.target).is("button")||$(event.target).is(":checkbox")||$(event.target).is("th"))?$(event.target):($(event.target).parents().is("a")&&$(event.target).parents("a"))?$(event.target).parents("a"):$self._emptyTarget;$.each(cllol,function(className,handler){if($target.is(className)){$self[handler]($target);$.Taiji.preventDefault(event);}});});});$.each($.Taiji.customEvents,function(name,handler){$target.off(name).on(name,function(event,form,options){$self[handler](form,options);});});},_emptyTarget:{is:function(className){return false;
}},_handleOperateError:function(statusCode,obj){this.isRunning=false;$.Taiji.hideLoading();if(statusCode===0||statusCode===12029){$.Taiji.showWarn($.Taiji.Messages.ERR_CONNECT);}else{$.Taiji.showWarn($.Taiji.Messages.ERR_RESPONSE+statusCode);}},aclCheck:function(obj){if(!this.settings.enableAclCheck){return;}var $obj=$(obj);var uris;if($obj.is(this.settings.aclClassName)){uris=$obj;}else{uris=$obj.find(this.settings.aclClassName);}var pathName=window.location.pathname;var rootUrl=pathName.substr(0,pathName.substr(1).indexOf("/")+1)+"/";var hrefs=uris.map(function(){return $(this).attr("href").replace(rootUrl,"");}).get().join(",");$.ajax({type:"POST",url:rootUrl+"app/acl/hasbuttons",data:"uris="+hrefs,async:false,dataType:"json",success:function(list){$.each(list,function(i,n){if(!n.hasButton){uris.filter("[href='"+rootUrl+n.uri+"']").hide();}});}});},validationTip:function(ejson,parent){var ejsonContent=$.parseJSON($(ejson).html());$.each(ejsonContent,function(i,n){var eles=$("[name='"+i+"']",parent);
if(eles.length>1){$("div[data-for='"+i+"']",parent).showPopover(n,{hideConcern:true});}else{$("[name='"+i+"']",parent).showPopover(n,{hideConcern:true});}});},showModal:function(element,opts){var defaults={size:"",backdrop:true,method:"GET"};var options=$.extend({},defaults,opts);this.ajaxHref(element,{method:options.method,bsSuccess:function(responseText,note){$.showModal(options,responseText);}});},ajaxHref:function(element,opts){var $element=$(element);var $url=$.Taiji.getUrl(element);if(!$url){$.Taiji.showWarn($.Taiji.Messages.ERR_URL);return;}var that=this;var execAjax=function(){if(that.isRunning===true){that.warn($.Taiji.Messages.WAR_OPERATE);return;}else{that.isRunning=true;}$element.prop("disabled",true);$.Taiji.showLoading($.Taiji.Messages.MSG_OPERATE);var containerDiv=that.currentTarget;if($element.parents(".modal-content").size()>0){containerDiv=$element.parents(".modal-content:last");}var bsSuccess=opts.bsSuccess||function(){};var bsComplete=opts.complete||function(){};if(!opts.type&&opts.method){opts.type=opts.method;
}opts.success=function(responseText,status,xhr){that.isRunning=false;$.Taiji.hideLoading();var responseHeader={note:xhr.getResponseHeader($.Taiji.Constans.RESPONSE_HEADER_NOTE),jme:xhr.getResponseHeader($.Taiji.Constans.RESPONSE_HEADER_JME),me:xhr.getResponseHeader($.Taiji.Constans.RESPONSE_HEADER_ME),cve:xhr.getResponseHeader($.Taiji.Constans.RESPONSE_HEADER_CVE),jump:xhr.getResponseHeader($.Taiji.Constans.RESPONSE_HEADER_JUMP)};if(responseHeader.jme){$.Taiji.showWarn(that.decode(responseHeader.jme));$(that.currentTarget).triggerHandler($.Event("taijiJME",{relatedTarget:$element}),responseText);}else{if(responseHeader.me){$.Taiji.showWarn(that.decode(responseHeader.me));$(that.currentTarget).triggerHandler($.Event("taijiME",{relatedTarget:$element}),responseText);}else{if(responseHeader.cve){var ejson=$(responseText).find("#taiji_ejson");that.validationTip(ejson,containerDiv);$.Taiji.showWarn($.Taiji.Messages.ERR_CVE);$(that.currentTarget).triggerHandler($.Event("taijiCVE",{relatedTarget:$element}),responseText);
}else{if(responseHeader.jump){window.location=responseHeader.jump;}else{bsSuccess.call(that,responseText,responseHeader.note&&that.decode(responseHeader.note));}}}}};opts.complete=function(xhr){$element.prop("disabled",false);bsComplete.call(that,xhr);};var dataObj={};var defaults={headers:{"taiji_ajax":"true"},type:"GET",url:$url,data:dataObj,traditional:true,async:true,error:function(xhr){that._handleOperateError(xhr.status,$element);$(that.currentTarget).triggerHandler($.Event("taijiERR",{relatedTarget:$element}),$.Taiji.Messages.ERR_RESPONSE+xhr.status);}};var options=$.extend({},defaults,opts);if($element.data("selector")){options.type="POST";$($element.data("selector")).each(function(){var e=$(this);if(e.attr("name")&&e.val()){var key=e.attr("name"),value=e.val();if(dataObj[key]){var oldVal=dataObj[key];if($.type(oldVal)=="array"){oldVal.push(value);}else{dataObj[key]=[];dataObj[key].push(oldVal);dataObj[key].push(value);}}else{dataObj[key]=value;}}});}var myXhr=$.ajax(options);};
var confirmMsg=$.Taiji.getConfirmMessage($element);$.Taiji.defConfirm(confirmMsg).done(execAjax);},ajaxForm:function(form,options){if(this.isRunning===true){this.warn($.Taiji.Messages.WAR_OPERATE);return;}else{this.isRunning=true;}$.Taiji.showLoading($.Taiji.Messages.MSG_OPERATE);var that=this,$form=$(form);var settings={headers:{"taiji_ajax":"true"},success:function(data,status,xhr){var responseHeader={note:xhr.getResponseHeader($.Taiji.Constans.RESPONSE_HEADER_NOTE),jme:xhr.getResponseHeader($.Taiji.Constans.RESPONSE_HEADER_JME),me:xhr.getResponseHeader($.Taiji.Constans.RESPONSE_HEADER_ME),cve:xhr.getResponseHeader($.Taiji.Constans.RESPONSE_HEADER_CVE),jump:xhr.getResponseHeader($.Taiji.Constans.RESPONSE_HEADER_JUMP)};$.Taiji.hideLoading();that.isRunning=false;if(responseHeader.note){options.bsSuccess.call(that,data,that.decode(responseHeader.note));}else{if(responseHeader.jme){$.Taiji.showWarn(that.decode(responseHeader.jme));$(that.currentTarget).triggerHandler($.Event("taijiJME",{relatedTarget:$form}),data);
}else{if(responseHeader.me){$.Taiji.showWarn(that.decode(responseHeader.me));$(that.currentTarget).triggerHandler($.Event("taijiME",{relatedTarget:$form}),data);}else{if(responseHeader.cve){var ejson=$(data).find("#taiji_ejson");that.validationTip(ejson,form);$.Taiji.showWarn($.Taiji.Messages.ERR_CVE);$(that.currentTarget).triggerHandler($.Event("taijiCVE",{relatedTarget:$form}),data);}else{if(responseHeader.jump){window.location=responseHeader.jump;}else{$.Taiji.showWarn($.Taiji.Messages.ERR_RESPONSE);$(that.currentTarget).triggerHandler($.Event("taijiERR",{relatedTarget:$form}),$.Taiji.Messages.ERR_RESPONSE+xhr.status);}}}}}},error:function(xhr){that._handleOperateError(xhr.status);$(that.currentTarget).triggerHandler($.Event("taijiERR",{relatedTarget:$form}),$.Taiji.Messages.ERR_RESPONSE+xhr.status);},dataType:"html",forceSync:true};$.extend(settings,options);var $files=$(":file",$form);if($files.size()===0){$(form).removeProp("enctype");}else{var filesSize=$files.size();$files.each(function(){if(!$(this).val()){filesSize--;
$(this).prop("disabled",true);}});if(filesSize===0){$(form).removeProp("enctype");}else{$(form).prop("enctype","multipart/form-data");}}$(form).ajaxSubmit(settings);$(":file",$form).each(function(){$(this).prop("disabled",false);});},log:function(msg){if(this.settings.debug===true&&window.console&&window.console.warn){window.console.warn(msg);}},warn:function(msg){if(this.settings.debug===true&&window.console&&window.console.log){window.console.log(msg);}},repostion:function(){this.$windowW=$(window).width();this.$windowH=$(window).height();this.$sw=$(document).scrollLeft();this.$sh=$(document).scrollTop();}}});$.extend($.Taiji,{extendMethod:function(aExtendMethod){$.Taiji.defaults[aExtendMethod.name]=aExtendMethod.config;$.each(aExtendMethod.event,function(event,coll){if(!$.Taiji.events[event]){$.Taiji.events[event]={};}if(!$.Taiji.events[event][aExtendMethod.name]){$.Taiji.events[event][aExtendMethod.name]={};}if(coll){$.each(coll,function(className,handler){$.Taiji.log("事件："+event+",插件："+aExtendMethod.name+"，class:"+className+",处理函数:"+handler);
$.Taiji.events[event][aExtendMethod.name][className]=handler;});}});if(aExtendMethod.customEvent){$.each(aExtendMethod.customEvent,function(i,event){$.Taiji.customEvents[i]=event;});}$.each(aExtendMethod.eventHandler,function(i,handler){$.Taiji.prototype[i]=handler;});if(aExtendMethod.init){$.Taiji.inits.push(aExtendMethod.init);}},inits:[],events:{},customEvents:{},Constans:{RESPONSE_HEADER_NOTE:"taiji_note",RESPONSE_HEADER_JME:"taiji_jme",RESPONSE_HEADER_ME:"taiji_me",RESPONSE_HEADER_CVE:"taiji_cve",RESPONSE_HEADER_JUMP:"taiji_jump"},preventDefault:function(event){if(event.preventDefault){event.preventDefault();}else{event.returnValue=false;}},Messages:{ERR_CVE:"校验失败，请看相关字段提示!",ERR_RESPONSE:"服务器返回了非预期的值，请联系技术人员，代码:",ERR_URL:"没有找到URL！",ERR_CONNECT:"您当前的网络连接异常！",WAR_NOTNODE:"未选中任何节点！",WAR_OPERATE:"前一次操作尚未完成，请稍候！",MSG_OPERATE:"操作进行中，请稍候！"},getUrl:function(obj){var $obj=$(obj);return $obj&&$obj.is("a")&&$obj.attr("href");},getConfirmMessage:function(obj){var $obj=$(obj);return $.metadata&&$obj.metadata().confirm_message?$obj.metadata().confirm_message:$obj.attr("confirm_message");
},getMetadata:function(obj,key){return $(obj).metadata()[key];},log:function(msg){if(window.console&&window.console.log){window.console.log(msg);}},showLoading:function(message){this.log("[_createLoading]"+message);$loadingDiv=$("#alert-loading");if(!$loadingDiv.length){var html='<div id="alert-loading" class="alert alert-info  ">'+"<strong></strong>"+'<div  class="fade in"><span class="spinner"></span></div>'+"</div>";$loadingDiv=$(html).prependTo(document.body);}$loadingDiv.find("strong").text(message).end().fadeIn(10);},hideLoading:function(){$("#alert-loading").fadeOut(10);},showWarn:function(message){if(typeof message!=="string"){this.log("[_showWarn] 非字符串无法显示");}if(!message){return;}var $warnDiv=$("#alert-info");if(!$warnDiv.length){var html='<div id="alert-info" class="alert alert-info  ">'+'<i class="fa fa-info-circle  fa-2x"></i>'+"<strong></strong>"+"</div>";$warnDiv=$(html).prependTo(document.body);}$warnDiv.find("strong").text(message).end().fadeIn(500).delay(2000).fadeOut(500);
},showNote:function(message){if(typeof message!=="string"){this.log("[_showNote] 非字符串无法显示");}if(!message){return;}var $noteDiv=$("#alert-success");if(!$noteDiv.length){var html='<div id="alert-success" class="alert alert-success  ">'+'<i class="fa fa-check-circle fa-2x "></i>'+"<strong></strong>"+"</div>";$noteDiv=$(html).prependTo(document.body);}$noteDiv.find("strong").text(message).end().fadeIn(500).delay(2000).fadeOut(500);},showProcess:function(percent,message,duration){var $alertProgress=$("#alert-progress");if($alertProgress&&$alertProgress.size()===1){$(".progress-bar",$alertProgress).text(percent+"%").css({"width":percent+"%"});$("strong",$alertProgress).text(message);}else{var html='<div id="alert-progress" class="alert alert-success  "  style="width:500px;display: block;">'+'<div class="progress progress-striped progress-lg active  m-t-5">'+'<div   class="progress-bar progress-bar-success"></div>'+"</div>"+"<strong></strong>"+"</div>";$alertProgress=$(html);$(".progress-bar",$alertProgress).text(percent+"%").css({"width":percent+"%","transition":"width "+duration+"s linear 0s"});
$("strong",$alertProgress).text(message);$alertProgress.appendTo("body");}},createSelectorForm:function(name,obj){var $obj=$(obj);var url=this.getUrl(obj);var $real=$($obj.data("selector"));var createForm=$("<form>",{"name":name+new Date().getTime(),action:url,method:"post"}).appendTo(document.body).hide();$real.each(function(){var $this=$(this),cloned=$this.clone(true);if($this.is(":file")){cloned.insertAfter($this).attr("id","cloned"+$this.attr("id"));$this.appendTo(createForm);}else{cloned.appendTo(createForm);}});return createForm;},removeSelectorForm:function($form){$form.find(":file").each(function(){var $this=$(this);var idSelector="#cloned"+$this.attr("id");$(idSelector).before($this).remove();});$form.remove();},defConfirm:function(message){var dtd=$.Deferred();if(message){if($.Taiji.confirm){$.Taiji.confirm({content:message,confirm:dtd.resolve,cancel:dtd.reject});}else{if(window.confirm(message)){dtd.resolve();}else{dtd.reject();}}}else{dtd.resolve();}return dtd.promise();},defaults:{enableAclCheck:false,aclClassName:".taiji_acl",debug:true}});
$.Taiji.base64=new Base64();})(jQuery,window,document);(function($){$.Taiji.extendMethod({name:"pager",event:{click:{"className":"_handlePagerClick","gotoClassName":"_handleGotoClick"}},eventHandler:{_handlePagerClick:function(element){var pageclickednumber=$(element).attr("value");this._handlePageClick(pageclickednumber);},_handlePageClick:function(pageclickednumber){var $pageNo=$("input[name='pageNo']",this.currentTarget);if($pageNo.attr("name")){$pageNo.val(pageclickednumber);}else{$pageNo=$("<input type='hidden' id='pageNo' name='pageNo'/>").val(pageclickednumber).appendTo($(this.searchFormClassName,this.currentTarget));}$(this.searchFormClassName,this.currentTarget).trigger("submit");},_handleGotoClick:function(element){var $ele=$(element);var $pageNo=$ele.parent().find(".taiji_pager_input");if($pageNo.is(".taiji_pager_input")){var clickValue=$.trim($pageNo.val());if(!clickValue){$.Taiji.showWarn("请填写跳转页数");return;}if(!/^\d+$/.test(clickValue)){$.Taiji.showWarn("请填写数字");return;}var pageclickednumber=parseInt(clickValue,10);
if(pageclickednumber>100000){$.Taiji.showWarn("页数太大，请重新填写");return;}this._handlePageClick(pageclickednumber);}else{this.warn("没有name为pageNo的input框");}}},config:{className:".taiji_pager_item",gotoClassName:".taiji_pager_goto"}});})(jQuery);(function($){$.Taiji.extendMethod({name:"multiCore",event:{change:{"checkAll":"_handleMultiCoreCheckAll"}},eventHandler:{_handleMultiCoreCheckAll:function(element){if($(element).is(":checked")){$(this.settings.multiCore.checkAll,this.currentTarget).prop("checked",true);$(this.settings.multiCore.checkOne,this.currentTarget).prop("checked",true);}else{$(this.settings.multiCore.checkAll,this.currentTarget).prop("checked",false);$(this.settings.multiCore.checkOne,this.currentTarget).prop("checked",false);}}},config:{checkAll:".taiji_check_all",checkOne:".taiji_check_one"}});})(jQuery);(function($){$.Taiji.extendMethod({name:"ajaxForm",event:{click:{"className":"_handleAjaxFormClick"}},eventHandler:{_handleAjaxFormClick:function(element){var $element=$(element),that=this;
var $targetForm=$($element.data("form"));if($targetForm.size()===0){$.Taiji.showWarn("form未找到！");return;}var options={method:"POST",bsSuccess:function(responseText,note){if($.Taiji.getMetadata($element,"target")){$($.Taiji.getMetadata($element,"target")).html(responseText);}$.Taiji.showNote(note);$(this.currentTarget).triggerHandler("taijiAjaxFormSuccess",[responseText]);if($.Taiji.getMetadata($element,"refresh")){$(this.searchFormClassName,this.currentTarget).submit();}}};var confirmMsg=$.Taiji.getConfirmMessage($element);$.Taiji.defConfirm(confirmMsg).done(function(){that.ajaxForm($targetForm.get(0),options);});}},config:{className:".taiji_ajaxForm"}});})(jQuery);(function($){$.Taiji.extendMethod({name:"async",event:{click:{"className":"_handleAsyncClick"}},eventHandler:{_handleAsyncClick:function(element){var that=this;var $asyncConfig=$.extend({},{"interval":4000},$(element).metadata());var options={bsSuccess:function success(responseText){var jsonRes=$.parseJSON(responseText);$.Taiji.showNote(jsonRes.msg);
if($("#alert-progress").size()===0){window.setTimeout(function(){that._handleAsyncProcess($asyncConfig.process,$asyncConfig.interval);},1000);}},dataType:"text"};var useForm=$($(element).data("selector")).is(":file");if(useForm){var selectorForm=$.Taiji.createSelectorForm("taijiAsyncForm",element);this.ajaxForm(selectorForm,options);$.Taiji.removeSelectorForm(selectorForm);}else{this.ajaxHref(element,options);}},_handleAsyncProcess:function($url,interval){var $this=this;$.ajax({url:$url,type:"POST",dataType:"json",success:function(responseText,status,xhr){var $alertProgress=$("#alert-progress");if(responseText.processType==="SUCCESS"){$($this.currentTarget).triggerHandler("taijiAsyncSuccess",[responseText.result]);$alertProgress.remove();return;}var percent=Math.round(responseText.percent*100);var duration=interval/1000;var resMsg=responseText.msg;$.Taiji.showProcess(percent,resMsg,duration);window.setTimeout(function(){$this._handleAsyncProcess($url,interval);},interval);}});}},config:{className:".taiji_async"}});
})(jQuery);(function($){$.extend({autocompleteAll:function(){var alls=$(".taiji_autocomplete:visible:not(._taiji_autocomplete)"),remotes=[],locals=[];$(alls).each(function(){if($(this).is("[data-url]")){remotes.push($(this));}else{locals.push($(this));}});$.autocompleteRemote(remotes);$.autocompleteLocal(locals);},autocompleteRemote:function(elems){$(elems).each(function(){var url=$(this).attr("data-url");var that=$(this);var key=that.attr("name");that.ajaxChosen({type:"POST",url:url,dataType:"json",minTermLength:1,afterTypeDelay:1000,jsonTermKey:key},function(data){var terms={};$.each(data,function(i,val){terms[val.id]=val.label;});return terms;}).addClass("_taiji_autocomplete");});},autocompleteLocal:function(elems){$(elems).each(function(){$(this).chosen({no_results_text:"没有匹配的选项!",search_contains:true}).addClass("_taiji_autocomplete");});}});})(jQuery);jQuery(function(){jQuery.autocompleteAll();});(function($){$.extend({showModal:function(opts,data){var defaults={size:"",backdrop:true};
var options=$.extend({},defaults,opts);var layer=$(".modal:visible").length;if(layer>=2){return;}var $modalDialog=$("#modal-dialog"+layer);if($modalDialog.length===0){var templateModal='<div class="modal fade" id="modal-dialog'+layer+'">'+'<div class="modal-dialog">'+'<div class="modal-content">'+"</div>"+"</div>"+"</div>";$modalDialog=$(templateModal).appendTo(document.body);$modalDialog.on("shown.bs.modal",function(){if($.autocompleteAll){$.autocompleteAll();}if($.fn.selectpicker){$modalDialog.find(".selectpicker").selectpicker("render");}if($(this).attr("id")=="modal-dialog1"){$("#modal-dialog0").css("overflow","hidden");}}).on("hidden.bs.modal",function(){$(this).removeClass("modal-message");$(this).find(".modal-dialog").removeClass("modal-lg").removeClass("modal-sm");$(this).find(".modal-content").empty();if($(this).attr("id")=="modal-dialog1"){$(document.body).addClass("modal-open");$("#modal-dialog0").css("overflow","");}});}if(options.size=="modal-message"){$modalDialog.addClass(options.size);
}else{$modalDialog.find(".modal-dialog").addClass(options.size);}$modalDialog.find(".modal-content").html(data);$modalDialog.modal({backdrop:options.backdrop,show:true});return $modalDialog;},hideModal:function(opts){$(".modal-open>.modal.in:last").modal("hide");}});$.fn.extend({showModal:function(opts){var defaults={complete:function(){}};var options=$.extend({},defaults,opts);var layer=$(".modal:visible").length;if(layer>=2){return;}if(this.length===0){return;}var $element=this.eq(0);var href=$element.attr("href");var dataObj={},method="GET";if($element.data("selector")){method="POST";$($element.data("selector")).each(function(){var e=$(this);if(e.attr("name")&&e.val()){var key=e.attr("name"),value=e.val();if(dataObj[key]){var oldVal=dataObj[key];if($.type(oldVal)=="array"){oldVal.push(value);}else{dataObj[key]=[];dataObj[key].push(oldVal);dataObj[key].push(value);}}else{dataObj[key]=value;}}});}if(options.data){method="POST";$.extend(dataObj,options.data);}$.ajax({type:method,url:href,data:dataObj,traditional:true,success:function(data){$.showModal(options,data);
},error:function(xhr){$.Taiji.showWarn($.Taiji.Messages.ERR_RESPONSE+xhr.status);},complete:function(xhr){options.complete.call($element);}});},hideModal:function(opts){$(".modal-open>.modal.in:last").modal("hide");}});})(jQuery);(function($){$.Taiji.extendMethod({name:"collapse",event:{click:{"className":"_handleCollapseClick"}},eventHandler:{_handleCollapseClick:function(element){var a=$(element);var sibling=a.closest("tr").next();if(sibling.hasClass("collapse")){sibling.remove();return;}var options={method:"POST",bsSuccess:function(data){var tr,td,container;tr=$("<tr>").addClass("collapse in");td=$("<td>",{"colspan":a.closest("tr").children().length}).appendTo(tr);container=$("<div>",{"class":"well","html":$(data)}).appendTo(td);a.closest("tr").after(tr);}};this.ajaxHref(element,options);}},config:{className:".taiji_collapse"}});})(jQuery);(function($){$.Taiji.extendMethod({name:"columnCompress",event:{click:{"className":"_handleColCompressClick"}},eventHandler:{_handleColCompressClick:function(element){var index=$(element).index();
var fourTables=this.currentTarget.find("#myTable-column,#myTable-fix,#myTable-header").add($(this.settings.search.resultClassName,this.currentTarget)).children("table");fourTables.toggleClass("col-compress"+(index+1)).find("th:eq("+index+")").toggleClass("on");}},config:{className:".taiji_column_compress"}});})(jQuery);(function($){$.Taiji.extendMethod({name:"download",event:{click:{"className":"_handleDownloadClick"}},eventHandler:{_handleDownloadClick:function(elment){var $this=$(elment);var $url=$.Taiji.getUrl($this);if(!$url){this.warn($.Taiji.Messages.ERR_URL);return;}if(this.isRunning===true){this.warn($.Taiji.Messages.WAR_OPERATE);return;}else{this.isRunning=true;}$this.prop("disabled",true);$.Taiji.showLoading($.Taiji.Messages.MSG_OPERATE);var $$this=this;var options={url:$url,type:"POST",dataType:"html",success:function(responseText,status,xhr){$$this.isRunning=false;if(xhr.getResponseHeader($.Taiji.Constans.RESPONSE_HEADER_NOTE)){window.open($url);}else{if(xhr.getResponseHeader($.Taiji.Constans.RESPONSE_HEADER_JME)){$.Taiji.showWarn($$this.decode(xhr.getResponseHeader($.Taiji.Constans.RESPONSE_HEADER_JME)));
}else{if(xhr.getResponseHeader($.Taiji.Constans.RESPONSE_HEADER_ME)){$.Taiji.showWarn($$this.decode(xhr.getResponseHeader($.Taiji.Constans.RESPONSE_HEADER_ME)));}else{if(xhr.getResponseHeader($.Taiji.Constans.RESPONSE_HEADER_CVE)){$.Taiji.showWarn($$this.decode(xhr.getResponseHeader($.Taiji.Constans.RESPONSE_HEADER_CVE)));}else{$.Taiji.showWarn($.Taiji.Messages.ERR_RESPONSE,xhr.status);}}}}$.Taiji.hideLoading();$this.prop("disabled",false);},error:function(xhr){$$this._handleOperateError(xhr.status,$this);}};$.ajax(options);},_bindDownload:function(){var $$this=this;$(this.settings.download.className,this.currentTarget).off("click.taiji").on("click.taiji",function(){$$this._handleDownloadClick(this);});}},config:{className:".taiji_download",callback:function(){}}});})(jQuery);(function($){$.Taiji.extendMethod({name:"export",event:{click:{"className":"_handleExportClick"}},eventHandler:{_handleExportClick:function(element){var downloadUrl=$(element).metadata().fileUrl||$.Taiji.getUrl(element)+"/file";
var options={bsSuccess:function success(responseText){window.location=downloadUrl+"?result="+responseText;}};this.ajaxHref(element,options);}},config:{className:".taiji_export"}});})(jQuery);(function($){$.Taiji.extendMethod({name:"modal",event:{click:{"modalDefault":"_handleDefaultModal","modalLage":"_handleLageModal","modalSmall":"_handleSmallModal","modalFull":"_handleFullModal"}},customEvent:{"taijiModalPost":"_handleModalPost"},eventHandler:{_handleDefaultModal:function(element){this._handleModal(element,"");},_handleLageModal:function(element){this._handleModal(element,"modal-lg");},_handleSmallModal:function(element){this._handleModal(element,"modal-sm");},_handleFullModal:function(element){this._handleModal(element,"modal-message");},_handleModal:function(element,size){var options={"size":size,backdrop:this.settings.modal.backdrop};this.ajaxHref(element,{bsSuccess:function(responseText,note){$.showModal(options,responseText);}});},_handleModalPost:function(form,opts){var myOpts={table:"add",bsSuccess:function(responseText,note){this._handleBsSuccess(responseText,note,options.table);
$().hideModal();}};var options=$.extend(myOpts,opts);this.ajaxForm(form,options);}},config:{modalDefault:".taiji_modal",modalLage:".taiji_modal_lg",modalSmall:".taiji_modal_sm",modalFull:".taiji_modal_full",backdrop:true}});})(jQuery);(function($){$.Taiji.extendMethod({name:"multiOperate",event:{click:{"className":"_handleMultiOperateClick"}},eventHandler:{_handleMultiOperateClick:function(element){var $$this=this;var $this=$(element);var $url=$.Taiji.getUrl($this);if(!$url){$$this.warn("没有找到批量删除的URL..");return false;}if(!this.settings.multiCore.checkOne){$$this.warn("未设定checkbox的class");return false;}var $checkedList=$(this.settings.multiCore.checkOne+":checked");if($checkedList.size()===0){$$this.warn("未选中任何项");$.Taiji.showWarn("请至少选中一个操作项");return false;}var $message=$.Taiji.getConfirmMessage($this);if($message){if(!window.confirm($message)){return false;}}if($$this.isRunning===true){$$this.warn("前一次<"+$$this.running+">操作尚未结束，当前multiOperate操作被禁止！");return false;}else{$$this.isRunning=true;
}$this.prop("disabled",true);$.Taiji.showLoading("批量操作操作进行中，请稍等");var dataA="";var theCheckboxName=$checkedList.attr("name");$checkedList.each(function(){dataA+=theCheckboxName;dataA+="=";dataA+=$(this).val();dataA+="&";});if(dataA.length>1){dataA=dataA.substr(0,dataA.length-1);}$.ajax({url:$url,type:"POST",data:dataA,dataType:"html",success:function(responseText,status,xhr){var responseHeader={note:xhr.getResponseHeader($.Taiji.Constans.RESPONSE_HEADER_NOTE),jme:xhr.getResponseHeader($.Taiji.Constans.RESPONSE_HEADER_JME),me:xhr.getResponseHeader($.Taiji.Constans.RESPONSE_HEADER_ME),cve:xhr.getResponseHeader($.Taiji.Constans.RESPONSE_HEADER_CVE)};$$this._handleMultiOperateSuccess(xhr.status,responseHeader,responseText,$this);},error:function(xhr){$$this._handleOperateError(xhr.status,$this);}});},_handleMultiOperateSuccess:function(status,responseHeader,responseText,obj){var $this=$(obj);$this.prop("disabled",false);$.Taiji.hideLoading();this.isRunning=false;if(responseHeader.note){$.Taiji.showNote(this.decode(responseHeader.note));
if(this.settings.multiOperate.callback&&typeof this.settings.multiOperate.callback==="function"){this.settings.multiOperate.callback(responseText);}$(this.currentTarget).trigger("taijiMultiOperateSuccess",[responseText]);}else{if(responseHeader.jme){$.Taiji.showWarn(this.decode(responseHeader.jme));}else{if(responseHeader.me){$.Taiji.showWarn(this.decode(responseHeader.me));}else{if(responseHeader.cve){$.Taiji.showWarn(this.decode(responseHeader.cve));}else{this.warn("服务器返回了非预期的值，请联系开发人员进行处理！,代码:",status);$.Taiji.showWarn("服务器返回了非预期的值，请联系开发人员进行处理！,代码:",status);}}}}}},afterSearchMethod:function(){var $$this=this;$(this.settings.multiOperate.checkAllClassName,this.currentTarget).off("change.taiji").on("change.taiji",function(event){if($(this).is(":checked")){$(":input[name="+$$this.settings.multiOperate.checkboxName+"]",$$this.currentTarget).prop("checked",true);$($$this.settings.multiOperate.checkAllClassName,$$this.currentTarget).prop("checked",true);}else{$(":input[name="+$$this.settings.multiOperate.checkboxName+"]",$$this.currentTarget).prop("checked",false);
$($$this.settings.multiOperate.checkAllClassName,$$this.currentTarget).prop("checked",false);}$.Taiji.preventDefault(event);});},config:{className:".taiji_multiOperate",callback:function(){}}});})(jQuery);(function($){$.Taiji.extendMethod({name:"multiRemove",event:{click:{"className":"_handleMultiRemoveClick"}},eventHandler:{_handleMultiRemoveClick:function(element){var $$this=this;var $this=$(element);var $url=$.Taiji.getUrl($this);if(!$url){$$this.warn("没有找到批量删除的URL..");return false;}if(!this.settings.multiCore.checkOne){$$this.warn("未设定checkbox的class");return false;}var $checkedList=$(this.settings.multiCore.checkOne+":checked");if($checkedList.size()===0){$.Taiji.showWarn("请至少选中一个操作项");return false;}var $message=$.Taiji.getConfirmMessage($this);if($message){if(!window.confirm($message)){return false;}}if(this.isRunning===true){this.warn($.Taiji.Messages.WAR_OPERATE);return false;}else{this.isRunning=true;}$this.prop("disabled",true);$.Taiji.showLoading("批量删除操作进行中，请稍等");var dataA="";
var theCheckboxName=$checkedList.attr("name");$checkedList.each(function(){dataA+=theCheckboxName;dataA+="=";dataA+=$(this).val();dataA+="&";});if(dataA.length>1){dataA=dataA.substr(0,dataA.length-1);}$.ajax({url:$url,type:"POST",data:dataA,dataType:"html",success:function(responseText,status,xhr){var responseHeader={note:xhr.getResponseHeader($.Taiji.Constans.RESPONSE_HEADER_NOTE),jme:xhr.getResponseHeader($.Taiji.Constans.RESPONSE_HEADER_JME),me:xhr.getResponseHeader($.Taiji.Constans.RESPONSE_HEADER_ME),cve:xhr.getResponseHeader($.Taiji.Constans.RESPONSE_HEADER_CVE)};$$this._handleMultiRemoveSuccess(xhr.status,responseHeader,responseText,$this);},error:function(xhr){$$this._handleOperateError(xhr.status,$this);}});},_handleMultiRemoveSuccess:function(status,responseHeader,responseText,obj){var $this=$(obj);$this.prop("disabled",false);$.Taiji.hideLoading();this.isRunning=false;if(responseHeader.note){var $checkedList=$(this.settings.multiCore.checkOne+":checked");var $size=$checkedList.size();
$checkedList.each(function(i,v){$(this).parents("tr").remove();});$(".taiji_pager .totalcount",this.currentTarget).each(function(){$(this).text(parseInt($(this).text(),10)-$size);});$.Taiji.showNote(this.decode(responseHeader.note));if(this.settings.multiRemove.callback&&typeof this.settings.multiRemove.callback==="function"){this.settings.multiRemove.callback(responseText);}$(this.currentTarget).trigger("taijiMultiRemoveSuccess",[responseText]);}else{if(responseHeader.jme){$.Taiji.showWarn(this.decode(responseHeader.jme));}else{if(responseHeader.me){$.Taiji.showWarn(this.decode(responseHeader.me));}else{if(responseHeader.cve){$.Taiji.showWarn(this.decode(responseHeader.cve));}else{this.warn("服务器返回了非预期的值，请联系开发人员进行处理！,代码:",status);$.Taiji.showWarn("服务器返回了非预期的值，请联系开发人员进行处理！,代码:",status);}}}}}},config:{className:".taiji_multiRemove",callback:function(){}}});})(jQuery);(function($){$.Taiji.extendMethod({name:"open",event:{},customEvent:{"taijiOpenPost":"_handleOpenPost"},eventHandler:{_handleOpenPost:function(form,opts){var myOpts={table:"add",bsSuccess:function(responseText,note){opener.$(opts.openerTarget).data("aTaiji")._handleBsSuccess(responseText,note,options.table);
window.close();}};var options=$.extend(myOpts,opts);this.ajaxForm(form,options);}},config:{}});})(jQuery);(function($){$.Taiji.extendMethod({name:"operate",event:{click:{"className":"_handleOperateClick"}},eventHandler:{_handleOperateClick:function(element){var $this=$(element);var options={method:"POST",bsSuccess:function(responseText,note){if($.Taiji.getMetadata($this,"target")){$($.Taiji.getMetadata($this,"target")).html(responseText);}$.Taiji.showNote(note);$(this.currentTarget).triggerHandler("taijiOperateSuccess",[responseText]);if($.Taiji.getMetadata($this,"refresh")){$(this.searchFormClassName,this.currentTarget).submit();}}};this.ajaxHref(element,options);}},config:{className:".taiji_operate"}});})(jQuery);(function($){$.Taiji.extendMethod({name:"remove",event:{click:{"className":"_handleRemoveClick"}},eventHandler:{_handleRemoveClick:function(element){var $this=$(element);var options={method:"POST",bsSuccess:function(responseText,note){this._handleBsSuccess(responseText,note,"remove");
}};this.ajaxHref(element,options);}},config:{className:".taiji_remove"}});})(jQuery);(function($){$.Taiji.extendMethod({name:"search",init:function(){this.searchFormClassName=this.settings.search.formClassName;this.moreCondition=this.settings.search.moreCondition;this.searchSubmitClassName=this.settings.search.submitClassName;this.searchResetClassName=this.settings.search.resetClassName;this.searchAutoRefreshEnable=this.settings.search.autoRefresh.enable;this.searchAutoRefreshInterval=this.settings.search.autoRefresh.interval;var $this=this;$(this.searchFormClassName,this.currentTarget).on("submit",function(event){$this._search($(this));$.Taiji.preventDefault(event);});$(this.searchFormClassName,this.currentTarget).find(":input:text").keydown(function(event){var $target=$(event.target);if(event.keyCode===13){$($this.searchSubmitClassName,$this.currentTarget).trigger("click");}});var $trigger=$(this.moreCondition,this.currentTarget);var target=$($trigger.data("target")||$trigger.attr("href"));
var originalHtml=$trigger.html();target.on("hidden.bs.collapse",function(){$trigger.html(originalHtml);}).on("shown.bs.collapse",function(){$trigger.html('<i class="fa fa-angle-double-up  m-r-10 "></i>收起');});if(this.settings.search.autoSearch===true){$(this.searchFormClassName,this.currentTarget).trigger("submit");}else{$(this.settings.search.resultClassName,this.currentTarget).find("> table > tbody").empty().append("<tr><td colspan='15' ><div class='taiji_not_found'>请先填写查询条件！</div></td></tr>");}},event:{click:{submitClassName:"_handleSearchSubmit",resetClassName:"_handleSearchReset"}},eventHandler:{_handleSearchSubmit:function(element){$(this.searchFormClassName,this.currentTarget).trigger("submit");},_handleSearchReset:function(element){$(this.searchFormClassName,this.currentTarget).trigger("reset");if($.fn.selectpicker){$(".selectpicker",this.currentTarget).selectpicker("render");}this._searchMoreCondition();},_search:function(form){if(this.isRunning===true){this.warn($.Taiji.Messages.WAR_OPERATE);
return;}else{this.isRunning=true;}var $this=this,options={headers:{"taiji_ajax":"true"},success:function success(responseText,status,xhr){var responseHeader={note:xhr.getResponseHeader($.Taiji.Constans.RESPONSE_HEADER_NOTE),jme:xhr.getResponseHeader($.Taiji.Constans.RESPONSE_HEADER_JME),me:xhr.getResponseHeader($.Taiji.Constans.RESPONSE_HEADER_ME),cve:xhr.getResponseHeader($.Taiji.Constans.RESPONSE_HEADER_CVE),jump:xhr.getResponseHeader($.Taiji.Constans.RESPONSE_HEADER_JUMP)};$.Taiji.hideLoading();$($this.searchSubmitClassName,$this.currentTarget).prop("disabled",false);$this.isRunning=false;if(responseHeader.note){$.Taiji.showNote($this.decode(responseHeader.note));$($this.currentTarget).triggerHandler("taijiNOTE",$this.decode(responseHeader.note));}else{if(responseHeader.jme){$.Taiji.showWarn($this.decode(responseHeader.jme));$($this.currentTarget).triggerHandler("taijiJME",$this.decode(responseHeader.jme));}else{if(responseHeader.me){$.Taiji.showWarn($this.decode(responseHeader.me));
$($this.currentTarget).triggerHandler("taijiME",$this.decode(responseHeader.me));}else{if(responseHeader.cve){var ejson=$(responseText).find("#taiji_ejson");$this.validationTip(ejson,$this.currentTarget);$($this.currentTarget).triggerHandler("taijiCVE",responseText);}else{if(responseHeader.jump){window.location=responseHeader.jump;}else{$this._handleSearchSuccess(responseText);}}}}}},error:function error(xhr){$this._handleOperateError(xhr.status,$($this.searchSubmitClassName,$this.currentTarget));$($this.currentTarget).triggerHandler("taijiERR",$.Taiji.Messages.ERR_RESPONSE+xhr.status);}};$.Taiji.showLoading($.Taiji.Messages.MSG_OPERATE);$(this.searchSubmitClassName,this.currentTarget).prop("disabled",true);$(this.searchFormClassName,this.currentTarget).ajaxSubmit(options);},_handleSearchSuccess:function(responseText){var $responseText=$(responseText);this._bindPager($responseText.find("#taiji_search_pager"));var $searchData=$responseText.find("#taiji_search_data");var $resultTarget=$(this.settings.search.resultClassName,this.currentTarget);
var seachResultType=this.settings.search.seachResultType;if(seachResultType==="tbody"){var hasText=$responseText.find("#taiji_search_data tbody").children().size()>0;if(hasText===true){var $tbody=$responseText.find("#taiji_search_data tbody");this.aclCheck($tbody);$resultTarget.find("> table > tbody").empty().append($tbody.html());}else{$resultTarget.find("> table > tbody").empty().append("<tr><td colspan='15' ><div class='taiji_not_found'>没有检索到符合条件的数据！</div></td></tr>");}this._bindDataClick();this._resultTableFloat();}else{if(seachResultType==="table"){this.aclCheck($searchData);$resultTarget.empty().append($searchData.html());this._bindDataClick();this._resultTableFloat();}else{this.aclCheck($searchData);$resultTarget.empty().append($searchData.html());}}var $this=this;if(this.searchAutoRefreshEnable===true){if(this.taijiSearchTimeoutId){window.clearTimeout(this.taijiSearchTimeoutId);}this.taijiSearchTimeoutId=window.setTimeout(function(){$($this.searchSubmitClassName,$this.currentTarget).trigger("click");
},$this.searchAutoRefreshInterval);}this._searchMoreCondition();$(this.currentTarget).triggerHandler("taijiSearchSuccess",[responseText]);},_bindPager:function($searchPager){if($searchPager.find("#taiji_search_hasMore").size()>0){this._createLargePager($searchPager);}else{this._createPager($searchPager);}},_createLargePager:function($searchPager){var $this=this,pageNo=window.parseInt($searchPager.find("#taiji_search_pageNo").text(),10),hasMore=$searchPager.find("#taiji_search_hasMore").text()=="true";if(isNaN(pageNo)||pageNo<1||!hasMore&&pageNo<=1){$(".taiji_pager",this.currentTarget).hide();}else{$(".taiji_pager",this.currentTarget).each(function(){var $ul=$("<ul  class='pagination  m-t-0' ></ul>");var $li_next=$("<li ><a href='#' class='taiji_pager_item' value='"+(pageNo+1)+"'>下一页</a></li>");if(pageNo<=5){for(var point=1;point<=pageNo;point++){$("<li ><a href='#' class='taiji_pager_item' value='"+point+"'>"+point+"</a></li>").appendTo($ul);}}else{$("<li ><a href='#' class='taiji_pager_item' value='1'>1</a></li>").appendTo($ul);
$("<li class='disabled'><a href='#' >...</a></li>").appendTo($ul);for(var point2=pageNo-3;point2<=pageNo;point2++){$("<li ><a href='#' class='taiji_pager_item' value='"+point2+"'>"+point2+"</a></li>").appendTo($ul);}}$ul.find("li:last-child").addClass("active").find("a").removeClass("taiji_pager_item");if(hasMore){$li_next.appendTo($ul);}$(this).html($ul);}).show();}},_createPager:function($searchPager){var $this=this,pageNo=window.parseInt($searchPager.find("#taiji_search_pageNo").text(),10),pageCount=window.parseInt($searchPager.find("#taiji_search_pagecount").text(),10),totalCount=window.parseInt($searchPager.find("#taiji_search_totalcount").text(),10);if(isNaN(pageCount)||pageCount<2||isNaN(pageNo)||pageNo<1||isNaN(totalCount)||totalCount<=0){$(".taiji_pager",this.currentTarget).hide();$(".taiji_pager_go",$this.currentTarget).hide();}else{$(".taiji_pager",this.currentTarget).each(function(){var $ul=$("<ul  class='pagination  m-t-0' ></ul>");var $li_total_record=$("<li ><span>共<strong class='totalCount'>"+totalCount+"</strong>条/<strong>"+pageCount+"</strong>页</span></li>").appendTo($ul);
var $li_prev=$("<li ><a href='#' class='taiji_pager_item' value='"+(pageNo-1)+"'>&lt;</a></li>").appendTo($ul);if(pageNo===1){$li_prev.addClass("disabled").find("a").removeClass("taiji_pager_item");}var startPoint=1,endPoint=5;if(pageNo>3){startPoint=pageNo-2;endPoint=pageNo+2;}if(endPoint>pageCount){startPoint=pageCount-4;endPoint=pageCount;}if(startPoint<1){startPoint=1;}for(var point=startPoint;point<=endPoint;point++){var $li_point=$("<li ><a href='#' class='taiji_pager_item' value='"+point+"'>"+point+"</a></li>").appendTo($ul);if(point===pageNo){$li_point.addClass("active").find("a").removeClass("taiji_pager_item");}}var $li_next=$("<li ><a href='#' class='taiji_pager_item' value='"+(pageNo+1)+"'>&gt;</a></li>").appendTo($ul);if(pageNo===pageCount){$li_next.addClass("disabled").find("a").removeClass("taiji_pager_item");}var $pager_input=$('<li><span class="input">到<input type="text" style="width:40px" value="100" class="taiji_pager_input">页</span><a class="taiji_pager_goto" href="#">跳转</a></li>').appendTo($ul);
$(this).html($ul);}).show();$(".taiji_pager_input",$this.currentTarget).val(pageNo);$(".taiji_pager_go",$this.currentTarget).show();}},_bindDataClick:function(){$(this.settings.search.resultClassName,this.currentTarget).find("> table > tbody > tr").off("click.taiji").on("click.taiji",function(event){$(this).addClass("taiji_clicked").siblings().removeClass("taiji_clicked");});},_resultTableFloat:function(){var searchResult=$(this.settings.search.resultClassName,this.currentTarget);var cloneResult=searchResult.clone().find("table").css("margin-top","").removeClass("table-striped table-hover table-bordered").end();var headerHeight=searchResult.find("table>thead").height();if($("#myTable-column",this.currentTarget).size()===0&&searchResult.hasClass("taiji_column_float")){searchResult.before($("<div>",{id:"myTable-column",html:cloneResult.html()})).before($("<div>",{id:"myTable-fix",html:cloneResult.html()}));$("#myTable-fix",this.currentTarget).height(headerHeight);$("#myTable-column,#myTable-fix",this.currentTarget).innerWidth(searchResult.attr("data-column-width")||50);
}else{if($("#myTable-column",this.currentTarget).size()>0){$("#myTable-column",this.currentTarget).find("table>tbody").replaceWith(searchResult.find("table>tbody").clone());$("#myTable-fix",this.currentTarget).find("table>tbody").replaceWith(searchResult.find("table>tbody").clone());}}var seachResultType=this.settings.search.seachResultType;var myTableHeader=$("#myTable-header",this.currentTarget);if(myTableHeader.size()===0&&searchResult.hasClass("taiji_table_float")){myTableHeader=$("<div>",{id:"myTable-header","class":"table-responsive",html:searchResult.clone().html()});searchResult.before(myTableHeader);myTableHeader.height(headerHeight);searchResult.find("table").css({"margin-top":-headerHeight});searchResult.scroll(function(){$("#myTable-header").scrollLeft($(this).scrollLeft());return false;}).scroll();}else{if(myTableHeader.size()>0&&seachResultType==="tbody"){myTableHeader.find(">table>tbody").replaceWith(searchResult.find("table>tbody").clone());}else{if(myTableHeader.size()>0&&seachResultType==="table"){myTableHeader.remove();
myTableHeader=$("<div>",{id:"myTable-header","class":"table-responsive",html:searchResult.clone().html()});searchResult.before(myTableHeader);myTableHeader.height(headerHeight);searchResult.find("table").css({"margin-top":-headerHeight});}}}if(myTableHeader.size()>0){var fixedTables=$("#myTable-header,#myTable-fix,#myTable-column",this.currentTarget).add(searchResult);var fixedTop=myTableHeader.offset().top-this.settings.search.tableFloatTop;$(document).off("scroll.taiji").on("scroll.taiji",function(){var e=$(document).scrollTop();var hasFixed=myTableHeader.hasClass("fixed");if(e>fixedTop&&fixedTop>0){if(!hasFixed){fixedTables.addClass("fixed");myTableHeader.innerWidth(searchResult.innerWidth());searchResult.scroll();}}else{if(hasFixed){fixedTables.removeClass("fixed");myTableHeader.innerWidth("");}}});if(seachResultType==="table"){$(document).triggerHandler("scroll.taiji");}}},_handleBsSuccess:function(responseText,note,table){var $row=$(responseText).find(".taiji_result_data tr");this.aclCheck($row);
if(table=="add"){var $tbody=$(this.settings.search.resultClassName,this.currentTarget).find("> table > tbody");$tbody.find(".taiji_clicked").removeClass("taiji_clicked");$tbody.prepend($row.addClass("taiji_clicked"));}else{if(table=="edit"||table=="update"){$(this.settings.search.resultClassName,this.currentTarget).find(".taiji_clicked").replaceWith($row.addClass("taiji_clicked"));}else{if(table=="remove"){$(this.settings.search.resultClassName,this.currentTarget).find(".taiji_clicked").remove();}}}var operateObj={add:{event:"taijiAddSuccess",plus:1},edit:{event:"taijiEditSuccess",plus:0},update:{event:"taijiUpdateSuccess",plus:0},remove:{event:"taijiRemoveSuccess",plus:-1},operate:{event:"taijiOperateSuccess",plus:0},none:{event:"taijiOperateSuccess",plus:0}};$(".taiji_pager .totalCount",this.currentTarget).each(function(){$(this).text(parseInt($(this).text(),10)+operateObj[table].plus);});this._bindDataClick();this._resultTableFloat();$.Taiji.showNote(note);$(this.currentTarget).triggerHandler(operateObj[table].event,[responseText]);
},_searchMoreCondition:function(){var $this=this;var container=$(".taiji_search_condition",$this.currentTarget);if(container.size()>0){var conds=$($this.searchFormClassName,$this.currentTarget).find(":text:enabled,:radio:checked,:checkbox:checked,select").filter(function(){return $(this).val();});container.empty().append("<label>已选择查询条件：</label>");conds.each(function(){var a=$(this);if(a.attr("name")=="pageSize"){return true;}var label;if(a.prev("label").size()>0){label=a.prev(".control-label");}else{label=a.parent().siblings(".control-label");}var item=$("<span>",{"class":"cond_item"});if(a.is(":checkbox")){item.append("<em>"+$(a[0].nextSibling).text()+"</em>");}else{if(a.is(":radio")){item.append("<b >"+label.text()+"：</b>");item.append("<em>"+$(a[0].nextSibling).text()+"</em>");}else{if(a.is("select")&&a.prop("multiple")){item.append("<b >"+label.text()+"：</b>");var optionsText=a.find("option:selected").map(function(){return $(this).text();}).get().join(",");item.append("<em>"+optionsText+"</em>");
}else{if(a.is("select")){item.append("<b >"+label.text()+"：</b>");item.append("<em>"+a.find("option:selected").text()+"</em>");}else{item.append("<b >"+label.text()+"：</b>");item.append("<em>"+a.val()+"</em>");}}}}var rm=$("<i>",{"class":"fa fa-times",click:function(){if(a.is(":radio")||a.is(":checkbox")){a.prop("checked",false);}else{a.val("");}if(a.hasClass("selectpicker")){a.selectpicker("render");}$(this).parent().remove();}});item.append(rm);container.append(item);});}}},config:{formClassName:".taiji_search_form",rules:{},messages:{},submitClassName:".taiji_search_submit",resetClassName:".taiji_search_reset",resultClassName:".taiji_search_result",dataClassName:".taiji_search_data",pagerClassName:".taiji_search_pager",moreCondition:".taiji_search_collapse",seachResultType:"tbody",tableFloatTop:54,autoRefresh:{enable:false,interval:60000},autoSearch:true}});})(jQuery);(function($){$.Taiji.extendMethod({name:"sortable",event:{click:{"className":"_handleSortableClick"}},eventHandler:{_handleSortableClick:function(element){var base=this;
var $this=$(element);if(base.isRunning===true){base.warn($.Taiji.Messages.WAR_OPERATE);return;}var sortName="",sortType="false";if($.metadata){var md=$this.metadata();sortName=md.orderBy;if(!sortName){return;}sortType=md.desc;if($this.hasClass("taiji_asc")){$this.removeClass("taiji_asc").addClass("taiji_desc");sortType="true";}else{if($this.hasClass("taiji_desc")){$this.removeClass("taiji_desc").addClass("taiji_asc");sortType="false";}else{if(sortType===true){$this.addClass("taiji_desc");}else{$this.addClass("taiji_asc");}}}}else{return;}var sortable=base.settings.sortable;var search=base.settings.search;var $searchForm=$(search.formClassName,base.currentTarget);var $sortName=$(base.currentTarget).find("input[name='orderBy']");if(!$sortName.val()){$sortName=$("<input type='hidden' name='orderBy'/>").appendTo($searchForm);}$sortName.val(sortName);var $sortType=$(base.currentTarget).find("input[name='desc']");if(!$sortType.val()){$sortType=$("<input type='hidden' name='desc'/>").appendTo($searchForm);
}$sortType.val(sortType);$(base.searchSubmitClassName,base.currentTarget).trigger("click");}},config:{className:".taiji_sortable"}});})(jQuery);(function($){$.Taiji.extendMethod({name:"update",event:{click:{"className":"_handleUpdateClick"}},eventHandler:{_handleUpdateClick:function(element){var $this=$(element);var options={method:"POST",bsSuccess:function(responseText,note){this._handleBsSuccess(responseText,note,"update");}};this.ajaxHref(element,options);}},config:{className:".taiji_update"}});})(jQuery);(function($){$.fn.extend({isVisible:function(){if($(this).isChosenSelect()){return true;}if(this.hasClass("selectpicker")&&this.hasClass("bs-select-hidden")){return true;}return $(this).attr("type")!=="hidden"&&$(this).css("display")!=="none"&&$(this).css("visibility")!=="hidden";},isChosenSelect:function(){return $(this).is("select")&&$(this).is(":hidden")&&$(this).next().is("div.chosen-container");},showPopover:function(content,options){if(!content||!$(this).isVisible()){return;}var control=this;
if(this.isChosenSelect()){control=this.next();}if(this.hasClass("selectpicker")&&this.hasClass("bs-select-hidden")){control=this.next(".bootstrap-select");}var errorEle=control.parent();errorEle.addClass("has-error");var opts=$.extend({},$.fn.showPopover.defaults,options);control.removeAttr("title").attr("data-content",content);control.popover(opts).popover("show");if(options&&options.hideConcern){control.off("click.taiji focus.taiji keydown.taiji");control.on("click.taiji focus.taiji keydown.taiji",function(){$(this).hidePopover();});}},hidePopover:function(){this.popover("hide");var errorEle=this.parent();errorEle.removeClass("has-error");}});$.fn.showPopover.defaults={placement:"auto",trigger:"manual"};if($.validator){$.validator.prototype.prepareElement=function(element){this.reset();var $ele=$(element);if($ele.is(":radio")||$ele.is(":checkbox")){this.toHide=$ele.closest("div[data-for='"+$ele.attr("name")+"']");}else{this.toHide=$ele;}};jQuery.validator.setDefaults({showErrors:function(errorMap,errorList){if(this.toHide.jquery&&errorList.length===0){this.toHide.hidePopover();
}$.each(errorList,function(i,obj){var $ele=$(obj.element);var msg=obj.message;var pop=$ele;if($ele.is(":radio")||$ele.is(":checkbox")){pop=$ele.closest("div[data-for='"+$ele.attr("name")+"']");}pop.showPopover(msg);});},debug:false});}})(jQuery);var tjUtils=tjUtils||{};(function($){$.extend(tjUtils,{toUpperCase:function(){$(this).val($(this).val().toUpperCase());},toLowerCase:function(){$(this).val($(this).val().toLowerCase());},scb2dbc:function(){var str=$(this).val(),result="";for(var i=0;i<str.length;i++){var c=str.charCodeAt(i);if(c===12888){result+=String.fromCharCode(32);}else{if(c>65280&&c<65375){result+=String.fromCharCode(c-65248);}else{result+=String.fromCharCode(c);}}}$(this).val(result);},toDbcUpperCase:function(){var str=$(this).val(),result="";for(var i=0;i<str.length;i++){var c=str.charCodeAt(i);if(c===12888){result+=String.fromCharCode(32);}else{if(c>65280&&c<65375){result+=String.fromCharCode(c-65248);}else{result+=String.fromCharCode(c);}}}$(this).val(result.toUpperCase());
},toDbcLowerCase:function(){var str=$(this).val(),result="";for(var i=0;i<str.length;i++){var c=str.charCodeAt(i);if(c===12888){result+=String.fromCharCode(32);}else{if(c>65280&&c<65375){result+=String.fromCharCode(c-65248);}else{result+=String.fromCharCode(c);}}}$(this).val(result.toLowerCase());}});})(jQuery);